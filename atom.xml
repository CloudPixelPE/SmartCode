<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[smartcode ltd]]></title>
  <link href="http://smartcodeltd.github.io/atom.xml" rel="self"/>
  <link href="http://smartcodeltd.github.io/"/>
  <updated>2014-07-15T20:00:18+01:00</updated>
  <id>http://smartcodeltd.github.io/</id>
  <author>
    <name><![CDATA[Jan Molak]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Taking a Moment - Unit Testing Time-Sensitive Code]]></title>
    <link href="http://smartcodeltd.github.io/blog/2014/07/10/taking-a-moment-unit-testing-time-sensitive-code/"/>
    <updated>2014-07-10T21:59:05+01:00</updated>
    <id>http://smartcodeltd.github.io/blog/2014/07/10/taking-a-moment-unit-testing-time-sensitive-code</id>
    <content type="html"><![CDATA[<p>Let&rsquo;s assume you have a piece of time-sensitive JavaScript code, where the result
of its execution depends on the time when it is executed:</p>

<figure class='code'><figcaption><span>src/greeter.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">Greeter</span><span class="p">()</span> <span class="p">{}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Greeter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">greet</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getHours</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;=</span> <span class="nx">now</span> <span class="o">&amp;&amp;</span> <span class="nx">now</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="s1">&#39;Good morning&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="s1">&#39;Hello&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>How would you test it?</p>

<!--more-->




<figure class='code'><figcaption><span>spec/greeter.spec.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Greeter&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;says &quot;Good morning&quot; between 5 AM and noon&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">greeter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Greeter</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// todo: control the time ...</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">expect</span><span class="p">(</span><span class="nx">greeter</span><span class="p">.</span><span class="nx">greet</span><span class="p">()).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="s1">&#39;Good morning&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ideally our <code>Greeter</code> object should not be relying on the system time directly,</p>

<h2>Inject the date</h2>

<p>describe(&lsquo;Greeter&rsquo;, function() {</p>

<pre><code>it('says "Good morning" between 5 AM and noon', function() {
    var greeter = new Greeter();

    // todo: control the time ...

    expect(greeter.greet()).to.equal('Good morning');
});
</code></pre>

<p>})</p>

<h2>Replace Date with Moment</h2>

<p>OK, but what if you can&rsquo;t change the code? Use sinon.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Objects under construction]]></title>
    <link href="http://smartcodeltd.github.io/blog/2014/07/06/objects-under-construction/"/>
    <updated>2014-07-06T16:10:53+01:00</updated>
    <id>http://smartcodeltd.github.io/blog/2014/07/06/objects-under-construction</id>
    <content type="html"><![CDATA[<p><a href="http://puttingtheteaintoteam.blogspot.co.uk/2008/10/is-that-pojo-or-nojo.html">http://puttingtheteaintoteam.blogspot.co.uk/2008/10/is-that-pojo-or-nojo.html</a>
An &ldquo;object&rdquo; (in object-oriented programming) has identity, state and behaviour. A NOJO has identity and state. A function has behaviour but not state. An object has identity, state and behaviour.</p>

<p><a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/#constructorpatternjavascript">http://addyosmani.com/resources/essentialjsdesignpatterns/book/#constructorpatternjavascript</a></p>

<h1>Privacy</h1>

<p>The Module pattern encapsulates &ldquo;privacy&rdquo;, state and organization using closures. It provides a way of wrapping a mix of public and private methods and variables, protecting pieces from leaking into the global scope and accidentally colliding with another developer&rsquo;s interface. With this pattern, only a public API is returned, keeping everything else within the closure private.
This gives us a clean solution for shielding logic doing the heavy lifting whilst only exposing an interface we wish other parts of our application to use. The pattern is quite similar to an immediately-invoked functional expression (IIFE &ndash; see the section on namespacing patterns for more on this) except that an object is returned rather than a function.
It should be noted that there isn&rsquo;t really an explicitly true sense of &ldquo;privacy&rdquo; inside JavaScript because unlike some traditional languages, it doesn&rsquo;t have access modifiers. Variables can&rsquo;t technically be declared as being public nor private and so we use function scope to simulate this concept. Within the Module pattern, variables or methods declared are only available inside the module itself thanks to closure. Variables or methods defined within the returning object however are available to everyone.</p>

<h1>Module pattern</h1>

<p>Advantages</p>

<p>We&rsquo;ve seen why the Constructor pattern can be useful, but why is the Module pattern a good choice? For starters, it&rsquo;s a lot cleaner for developers coming from an object-oriented background than the idea of true encapsulation, at least from a JavaScript perspective.</p>

<p>Secondly, it supports private data &ndash; so, in the Module pattern, public parts of our code are able to touch the private parts, however the outside world is unable to touch the class&rsquo;s private parts (no laughing! Oh, and thanks to David Engfer for the joke).</p>

<p>Disadvantages</p>

<p>The disadvantages of the Module pattern are that as we access both public and private members differently, when we wish to change visibility, we actually have to make changes to each place the member was used.</p>

<p>We also can&rsquo;t access private members in methods that are added to the object at a later point. That said, in many cases the Module pattern is still quite useful and when used correctly, certainly has the potential to improve the structure of our application.</p>

<p>Other disadvantages include the inability to create automated unit tests for private members and additional complexity when bugs require hot fixes. It&rsquo;s simply not possible to patch privates. Instead, one must override all public methods which interact with the buggy privates. Developers can&rsquo;t easily extend privates either, so it&rsquo;s worth remembering privates are not as flexible as they may initially appear.</p>

<h1>Revealing Module Pattern</h1>

<p> Christian Heilmannâ€™s</p>

<p> Advantages</p>

<p> This pattern allows the syntax of our scripts to be more consistent. It also makes it more clear at the end of the module which of our functions and variables may be accessed publicly which eases readability.</p>

<p> Disadvantages</p>

<p> A disadvantage of this pattern is that if a private function refers to a public function, that public function can&rsquo;t be overridden if a patch is necessary. This is because the private function will continue to refer to the private implementation and the pattern doesn&rsquo;t apply to public members, only to functions.</p>

<p> Public object members which refer to private variables are also subject to the no-patch rule notes above.</p>

<p> As a result of this, modules created with the Revealing Module pattern may be more fragile than those created with the original Module pattern, so care should be taken during usage.</p>
]]></content>
  </entry>
  
</feed>
